# 媒体播放器接口规范

本文档旨在详细说明需要与展陈播控平台集成的媒体播放器设备所应遵循的网络通信协议。平台作为客户端，向媒体播放器发送指令以控制媒体播放、音量及其他相关功能。

## 1. 通信协议

-   **协议类型:** TCP (传输控制协议)
-   **IP地址与端口:** 每台播放器设备的IP地址和端口在平台的播放设备中配置，平台将与该地址建立TCP连接。
-   **字节序:** 所有多字节数值均采用 **小端字节序 (Little-Endian)** 格式编码。

## 2. 帧结构

所有数据包，无论是从服务端到播放器还是反向，都遵循统一的帧结构。

### 包头 (12字节)

| 字段 | 大小 (字节) | 默认值 | 描述 |
| :--- | :--- | :--- | :--- |
| `Head` | 4 | `0x55CC55CC` | 固定包头，用于识别协议。以小端字节序发送时为 `CC 55 CC 55`。 |
| `Packet Type` | 2 | `0x0001` | 保留字段，应设为1。 |
| `Protocol Version` | 2 | `0x0001` | 协议版本号，例如 `0x0101` 代表 v1.1。 |
| `Sequence` | 2 | 自增 | 包序列号，由发送方递增。 |
| `Content Length` | 2 | 计算得出 | 内容区的总长度，包含TLV头和TLV值。 |

### 内容区 (TLV结构)

包头之后的内容区采用 **类型-长度-值 (Type-Length-Value, TLV)** 格式。

| 字段 | 大小 (字节) | 描述 |
| :--- | :--- | :--- |
| `Tag` | 2 | 命令或响应类型的唯一标识符。 |
| `Length` | 2 | `Value` 字段的字节长度。 |
| `Value` | N | 命令或响应的实际数据载荷，其结构取决于 `Tag`。 |

## 3. 指令列表

平台将向媒体播放器发送以下指令。播放器必须监听并解析这些指令，执行相应操作。

### 节目与媒体控制

| 指令功能 | Tag (十进制) | Tag (十六进制) | 值 (载荷) 结构 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| **获取节目列表** | 129 | `0x0081` | (空) | 请求播放器返回所有可用节目列表。 |
| **淡入切换节目** | 131 | `0x0083` | `programID` (4字节, uint32) | 淡入淡出到指定节目。 |
| **直接切换节目** | 132 | `0x0084` | `programID` (4字节, uint32) | 直接切换到指定节目。 |
| **暂停节目** | 133 | `0x0085` | `programID` (4字节, uint32) | 暂停指定节目。 |
| **播放节目** | 271 | `0x010F` | `programID` (4字节, uint32) | 播放指定节目。 |
| **停止节目** | 272 | `0x0110` | `programID` (4字节, uint32) | 停止指定节目。 |
| **播放图层媒体** | 273 | `0x0111` | `layerIndex` (4字节, uint32) | 播放当前节目中指定图层的媒体。 |
| **暂停图层媒体** | 274 | `0x0112` | `layerIndex` (4字节, uint32) | 暂停当前节目中指定图层的媒体。 |
| **获取节目所有媒体** | 276 | `0x0114` | `programID` (4字节, uint32) | 请求指定节目内的所有媒体文件列表。 |
| **查询图层进度** | 293 | `0x0125` | `layerIndex` (2字节, uint16) | 查询指定图层的播放进度。 |
| **获取当前节目** | 294 | `0x0126` | (空) | 查询当前正在播放的节目ID和状态。 |

### 声音控制

| 指令功能 | Tag (十进制) | Tag (十六进制) | 值 (载荷) 结构 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| **打开全局声音** | 262 | `0x0106` | (空) | 取消全局静音。 |
| **关闭全局声音** | 263 | `0x0107` | (空) | 设置全局静音。 |
| **设置全局音量** | 264 | `0x0108` | `volume` (4字节, uint32, 0-100) | 设置全局音量。 |
| **增加音量** | 328 | `0x0148` | `step` (4字节, uint32) | 按指定步长增加全局音量。 |
| **减小音量** | 329 | `0x0149` | `step` (4字节, uint32) | 按指定步长减小全局音量。 |
| **查询图层音量/静音** | 322 | `0x0142` | `layerIndex` (2字节, uint16) | 查询指定图层的音量和静音状态。 |

## 4. 响应格式

对于需要响应的指令，媒体播放器应返回一个结构相同的包。响应中的 `Tag` 应与请求的 `Tag` 匹配，`Value` 字段包含响应数据。

### 示例响应：获取节目列表

播放器应返回一个或多个数据包。第一个包的Value包含节目总数，后续数据包含每个节目的详细信息。

-   **响应 TLV - Value[]**
    -   `ProgramCount` (4字节, uint32): 节目总数。
    -   `ProgramIndex` (4字节, uint32): 节目在列表中的索引 (从0开始)。
    -   `ProgramId` (4字节, uint32): 节目的唯一ID。
    -   `ProgramName` (128字节, string, UTF-8): 节目名称。
    -   `IsEmpty` (1字节, uint8): `0` 表示空节目, `1` 表示非空节目。

### 示例响应：查询图层进度

-   **响应 TLV - Value[]**
    -   `Success` (1字节, uint8): `1` 表示成功, `0` 表示失败。
    -   `LayerIndex` (2字节, uint16): 图层索引。
    -   `RemainTime` (4字节, uint32): 剩余播放时间（秒）。
    -   `TotalTime` (4字节, uint32): 总播放时间（秒）。
